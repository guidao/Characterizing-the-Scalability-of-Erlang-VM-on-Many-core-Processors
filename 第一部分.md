###第一章
#### 介绍

大量的处理器单元被集成在一个芯片上或者说包得数量在增长。我们将看到越来越多的用于生产目的甚至是嵌入式系统的处理器有着几十，几百甚至上千的核心。大量核心时代即将到来。多核处理器包含着大量的核心。虽然下限没有被定义，但是通常来说一个处理器有超过30个核心可称为大量核心。这比传统的处理器更加高效。例如：一个芯片上的网络功能被用于连接所有的其它核心.

##### 1.1 动机和目的

在软件开发上如何最大化的利用大量核心的系统成为了巨大的挑战。程序必须在同时并行的运行在不同的核心上。工作量会被这些核心上平衡分配。不同的任何访问共同的资源通过同步来控制并且同步必须尽可能少。我们需要好的编程模型，工具或者语言来使得在大量核心的平台上开发更加容易且更高效。

erlang是一个门编程语言，被设计用于并行，软实时，分布式，错误容忍软件系统。erlang原生支持并发编程，并且提供了一个在大量核心系统上开发的一个高效的方式。在erlang中，程序员标示出任务的一小块，然后通过产生一个轻量的erlang进程去执行这个小块任务。运行时系统中的调度器自动分配工作量给处理器的不同核心。erlang进程的同步通过异步消息传递实现。当一个进程已经完成了一些工作，它发送消息给其它为此等待着的进程。程序员不关心锁，互斥，信号量和其他同步原语。因为这里没有共享内存。所有这些单调乏味的同步机制都隐藏在运行时系统之下。共享内存和同步方法仅仅被用于erlang虚拟机实现更高等级的特性，例如消息传递。可扩展性德erlang引用依靠erlang虚拟机执行。

这个项目的目标是研究erlang虚拟机的实现，评价它在大量核心平台的可扩展性，标识瓶颈所在并提供一些提高执行效率的建议。这个研究也分析了虚拟机代码中关于在大量核心处理器上执行的主要的一部分代码，例如同步原语，内存管理和调度算法。介绍了当前使用的技术和更好技术的介绍。这个研究结果也给出了关于准备在many-core平台进行软件开发的一些见解。

##### 1.2 方法

被用于这个项目的处理器TILEPro64为Tilera所开发。TILEPro64是一个典型的用于生产目的的many-core CPU，它有64个核心。它集成了通过一个8*8的网去连接其他核心的网络功能，内存子系统和其他外围的功能。这个网络功能提供了比传统总线或者跨总线连接更高的频率并且当添加新的核心时更容易扩展。

一些erlang基准程序被erlang虚拟机利用和执行。测试结果显示当前的erlang虚拟机版本在TILEPro64处理器上达到了非常好的可扩展性。一些基准测试程序从40核心到50核心的达到了最大效率提升。这也可能是通过减少锁冲突而提升的。在基准程序测试期间，一个主要的问题是发现在并行程序运行在一个核心的虚拟机上是在这一系列基准测试中最慢的。未来分析指出非竞争锁是诱发同步延长的主要原因。低消耗锁，自由锁结构或者算法被建议用于提高erlang虚拟机的执行速度。

##### 1.3 限制

这个项目仅仅调查了erlang运行时系统的可扩展性。理想情况下，如果一个程序有足够的并非性，那么当处理器的核心增加时，程序的执行效率成线性增长。也可以说，当核心数增加时，程序的执行时间线性的减少。比较可扩展性的量化单位是速度的提升，它指出了在多核与单核之间的执行时间的提升的比例。

为了评价erlang运行时系统的能力，那么它的执行效率也应该更其他程序语言进行比较，例如c，c++。但是这个在这个项目中不被考虑，原因是这个项目的目标是调查在many-core系统中介绍的新问题。

而且，仅仅分析erlang运行时系统核心的一部分，erlang有一系列的开发工具，链接库和数据库，它们被叫做OTP（开源电信项目）。这个特性在这里不被关心。更多的，我们关系字节码的执行并且也不会研究原生编译代码的执行。网络和IO函数也不好被调查研究。

基准测试程序不是真正的项目。它们是synthetic 基准测试或者是micro-benchmarks。最后，这个项目的结果不能非常好的反映真实的erlang虚拟机的执行速度。它更好的通过一套基准测试程序测试，这套程序包含多种多样的工作量。但是这不是非常适合erlang。而且，为了评价many-core系统的可扩展性，序列化的基准程序不能使用，因为它不能通过多核心提高执行效率。甚至有的并行程序如果没有良好的并行性或者被其他因素限制（例如：网络频率），它们也不会在这个项目中使用。

erlang/OTP是一个不断进化的平台。运行时系统不断的被维护者优化。在这个项目中，使用的是R13B04版本，所以这里和后面的所有的描述和结果都是基于此版本。我们也会聚焦在erlang虚拟机的并行版本SMP。在项目快要结束的时候，发布了R14B版本，它在多核心平台上跟R13B04版本有着相同的执行速度，除了在读写锁有着一点优化。附加说明：如果没有特殊说明，一般情况下这个测试跟分析基于linux操作系统。这个SMP linux操作系统构建在Tilera的TILEPro64上，内核版本是2.6.26.7-MDE-2.1.0-rc.94454，编译器是tile-cc，版本是2.1.0-rc.94454。

##### 1.4 论文提纲

这篇论文组织如下。第二章，介绍erlang的背景，TILEPro64处理器和描述如何计算速率。也会介绍些相关的工作和贡献。第三章，展示erlang虚拟机实现的更多细节。更重要的是对many-core的执行有了直观的印象，例如消息传递，同步原语，内存管理和调度。第四章，对评估的结果进行描述和分析。这里会给出一些优化建议。第五章，论文的结束和对未来研究的建议。
